<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Lead Finder</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #fff;
    color: #000;
    padding: 40px;
    max-width: 700px;
    margin: auto;
}
input, button {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    border: 1px solid #000;
}
button {
    background: #000;
    color: #fff;
    cursor: pointer;
}
button:hover { opacity: 0.8; }
.lead {
    border-top: 1px solid #000;
    padding: 15px 0;
}
.loader {
    display: none;
    margin: 20px 0;
}
.error {
    color: red;
    margin-top: 10px;
}
</style>
</head>
<body>

<h1>Lead Finder</h1>

<input id="keyword" placeholder="Fraza (np. ≈º≈Çobek)">
<input id="location" placeholder="Miasto (np. Bia≈Çystok)">
<input id="limit" type="number" value="5" max="5" min="1">

<button onclick="searchLeads()">Wyszukaj</button>

<div class="loader" id="loader">≈Åadowanie...</div>
<div class="error" id="error"></div>
<div id="results"></div>

<script>
async function searchLeads() {

    const keyword = document.getElementById('keyword').value.trim();
    const location = document.getElementById('location').value.trim();
    let limit = document.getElementById('limit').value;

    if (!keyword || !location) {
        alert("Uzupe≈Çnij wszystkie pola.");
        return;
    }

    if (limit > 5) limit = 5;

    document.getElementById('results').innerHTML = "";
    document.getElementById('error').innerText = "";
    document.getElementById('loader').style.display = "block";

    try {

        const response = await fetch("https://mz01.app.n8n.cloud/webhook/lead-search", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                keyword,
                location,
                limit
            })
        });

        const raw = await response.json();
        console.log("RAW:", raw);

        // üî• KLUCZOWA LINIA
        const data = Array.isArray(raw) ? raw : raw.data || raw.json || [];

        if (!data || data.length === 0) {
            document.getElementById('results').innerHTML = "<p>Brak wynik√≥w.</p>";
        } else {
            renderResults(data);
        }

    } catch (err) {
        document.getElementById('error').innerText = "WystƒÖpi≈Ç b≈ÇƒÖd podczas pobierania lead√≥w.";
        console.error(err);
    }

    document.getElementById('loader').style.display = "none";
}

function renderResults(data) {

    const container = document.getElementById('results');
    container.innerHTML = "";

    data.forEach(lead => {

        const div = document.createElement("div");
        div.className = "lead";

        div.innerHTML = `
            <h3>${lead.name || "Brak nazwy"}</h3>
            ${lead.website ? `<a href="${lead.website}" target="_blank">${lead.website}</a>` : ""}
            <div class="meta">Email: ${lead.email || "brak (tymczasowo)"}</div>
            <div class="meta">${lead.description || "Opis firmy zostanie wygenerowany automatycznie."}</div>
            <div class="suggestion">${lead.suggestion || "Sugestia kontaktu zostanie wygenerowana przez AI."}</div>
        `;

        container.appendChild(div);
    });
}
</script>

</body>
</html>